machine:
  environment:
    PROJECT: $CIRCLE_PROJECT_REPONAME
    USER: $CIRCLE_PROJECT_USERNAME
    IMPORT_PATH: "github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME"
    APP_PATH: $GOPATH/src/$IMPORT_PATH

checkout:
  post:
    - rm -rf $APP_PATH
    - mv ~/$PROJECT $APP_PATH
    - ln -s $APP_PATH ~/$PROJECT
# machine:
#   environment:
#     IMPORT_PATH: "github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME"
#     GOPATH: "$HOME/.go_workspace"
#
# dependencies:
#   override:
#     - mkdir -p "$GOPATH/src/$IMPORT_PATH"
#     - rsync -azC --delete ./ --include=".git" "$GOPATH/src/$IMPORT_PATH/"
#   post:
#     - cd "$GOPATH/src/$IMPORT_PATH" && git branch --set-upstream-to="origin/$CIRCLE_BRANCH" && go get -u -f -t ./...

dependencies:
  override:
    - cd $APP_PATH && go get -u -f -t -v ./...

test:
  pre:
    - go vet ./...
  override:
    - go test ./... -race
